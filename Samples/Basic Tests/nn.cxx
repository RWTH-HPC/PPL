/*********************************************************************/
/*        This is a generated C++ source file.                       */
/*        Generated by PatternDSL.                                   */
/*********************************************************************/

#include <vector>
#include <cstdint>
#include <string>
#include <limits>
#include <iostream>
#include "includes/Patternlib.hxx"
#include "includes/PThreadsLib.hxx"
#include "includes/nn.hxx"
#include "includes/cuda_lib_nn.hxx"
#include "mpi.h"
#include "includes/cuda_pool_lib.hxx"
#include "math.h"




/*********************************************************************/
/*        Global Variables                                           */
/*        Generated by PatternDSL .                                  */
/*********************************************************************/



/*********************************************************************/
/*        Function Declarations                                      */
/*        Generated by PatternDSL.                                   */
/*********************************************************************/



int main(int argc, char** argv) {
    long long time;
	float* activations_1_fDjHO1CRW1;
	float* activations_7_RJgsycQ8Eh;
	float* result_lB8Y2jSu7K;
	float* activations_6_H4d7Vnb3tP;
	float* activations_3_d2FySJrNO8;
	float* activations_2_j3fti3BN6j;
	float* activations_5_gielxoWvAU;
	float* activations_4_UuAc29EIlG;
	float* batch_GkpriWeNHS;
	float* weights_3_aPXpgT7mlK;
	float* weights_2_PULl08Tzft;
	float* weights_1_1gUuD5JLuk;
	float* weights_8_exzdbedc44;
	float* weights_7_LJVmWXj3HV;
	float* weights_6_SpUa0qY8sP;
	float* weights_5_dUKeqRRt9x;
	float* weights_4_WDk6GW21eM;
	int NUM_CORES;
	int NUM_GPUS;

	int rank, nprocs;
	MPI_Status Stat;
	MPI_Init(&argc, &argv);
	MPI_Comm_size(MPI_COMM_WORLD, &nprocs);
	MPI_Comm_rank(MPI_COMM_WORLD, &rank);
	if (rank == 0 ) {
		NUM_CORES = 47;
		NUM_GPUS = 2;
	} else 	if (rank == 1 ) {
		NUM_CORES = 47;
		NUM_GPUS = 2;
	}
	std::vector<pthread_t> pthreads(0);
	std::vector<Thread*> pool(NUM_CORES);
	setPool(&pool,&pthreads);
	std::vector<ThreadGPU> gpu_pool(NUM_GPUS);
	setGPUPool(&gpu_pool);
	startExecution();
	startGPUExecution();
	weights_3_aPXpgT7mlK = Init_List(weights_3_aPXpgT7mlK, 64LL * 64LL * 1LL);
	weights_1_1gUuD5JLuk = Init_List(weights_1_1gUuD5JLuk, 64LL * 64LL * 1LL);
	activations_4_UuAc29EIlG = Init_List(activations_4_UuAc29EIlG, 262144LL * 64LL * 1LL);
	weights_4_WDk6GW21eM = Init_List(weights_4_WDk6GW21eM, 64LL * 64LL * 1LL);
	activations_2_j3fti3BN6j = Init_List(activations_2_j3fti3BN6j, 262144LL * 64LL * 1LL);
	activations_6_H4d7Vnb3tP = Init_List(activations_6_H4d7Vnb3tP, 262144LL * 64LL * 1LL);
	weights_8_exzdbedc44 = Init_List(weights_8_exzdbedc44, 10LL * 64LL * 1LL);
	activations_1_fDjHO1CRW1 = Init_List(activations_1_fDjHO1CRW1, 262144LL * 64LL * 1LL);
	weights_2_PULl08Tzft = Init_List(weights_2_PULl08Tzft, 64LL * 64LL * 1LL);
	weights_7_LJVmWXj3HV = Init_List(weights_7_LJVmWXj3HV, 64LL * 64LL * 1LL);
	activations_5_gielxoWvAU = Init_List(activations_5_gielxoWvAU, 262144LL * 64LL * 1LL);
	batch_GkpriWeNHS = Init_List(batch_GkpriWeNHS, 262144LL * 64LL * 1LL);
	activations_3_d2FySJrNO8 = Init_List(activations_3_d2FySJrNO8, 262144LL * 64LL * 1LL);
	weights_5_dUKeqRRt9x = Init_List(weights_5_dUKeqRRt9x, 64LL * 64LL * 1LL);
	weights_6_SpUa0qY8sP = Init_List(weights_6_SpUa0qY8sP, 64LL * 64LL * 1LL);
	result_lB8Y2jSu7K = Init_List(result_lB8Y2jSu7K, 262144LL * 10LL * 1LL);
	activations_7_RJgsycQ8Eh = Init_List(activations_7_RJgsycQ8Eh, 262144LL * 64LL * 1LL);
	float* GPU_Data_b2UXdfG3KN;
	if (rank == 0) {
		auto f_alloc_7ApEuk25On = [&] () {
			cuda_alloc_wrapper(&GPU_Data_b2UXdfG3KN, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_7ApEuk25On);
	}
	if (rank == 0) {
		auto f_gpu_WLX2ob9p0V = [&] () {
			cuda_wrapper_rand_init_eeNUSUs3M2_WLX2ob9p0V(GPU_Data_b2UXdfG3KN );
		};
		getGPUPool()->at(0).addWork(f_gpu_WLX2ob9p0V);
	}
	float* GPU_Data_SDFyWcj1Ko;
	if (rank == 0) {
		auto f_alloc_yUKp1RLptP = [&] () {
			cuda_alloc_wrapper(&GPU_Data_SDFyWcj1Ko, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_yUKp1RLptP);
	}
	if (rank == 0) {
		auto f_gpu_eDdEMWtudn = [&] () {
			cuda_wrapper_rand_init_PlH53hIC5U_eDdEMWtudn(GPU_Data_SDFyWcj1Ko );
		};
		getGPUPool()->at(0).addWork(f_gpu_eDdEMWtudn);
	}
	float* GPU_Data_Vy4uSX878x;
	if (rank == 0) {
		auto f_alloc_3fDh2tQd2o = [&] () {
			cuda_alloc_wrapper(&GPU_Data_Vy4uSX878x, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_3fDh2tQd2o);
	}
	if (rank == 0) {
		auto f_gpu_ePAri9DhVW = [&] () {
			cuda_wrapper_rand_init_eq1HFX6DF2_ePAri9DhVW(GPU_Data_Vy4uSX878x );
		};
		getGPUPool()->at(0).addWork(f_gpu_ePAri9DhVW);
	}
	float* GPU_Data_tEEWFEjpKO;
	if (rank == 0) {
		auto f_alloc_lQJHbICP7H = [&] () {
			cuda_alloc_wrapper(&GPU_Data_tEEWFEjpKO, sizeof(float) * 640);
		};
		getGPUPool()->at(0).addWork(f_alloc_lQJHbICP7H);
	}
	if (rank == 0) {
		auto f_gpu_YvV3g1HMS2 = [&] () {
			cuda_wrapper_rand_init_YvV3g1HMS2(GPU_Data_tEEWFEjpKO );
		};
		getGPUPool()->at(0).addWork(f_gpu_YvV3g1HMS2);
	}
	float* GPU_Data_feNa1AmxDL;
	if (rank == 0) {
		auto f_alloc_gmdk22cYME = [&] () {
			cuda_alloc_wrapper(&GPU_Data_feNa1AmxDL, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_gmdk22cYME);
	}
	if (rank == 0) {
		auto f_gpu_krQlq6Omgs = [&] () {
			cuda_wrapper_rand_init_ndBZfLHlBF_krQlq6Omgs(GPU_Data_feNa1AmxDL );
		};
		getGPUPool()->at(0).addWork(f_gpu_krQlq6Omgs);
	}
	float* GPU_Data_T1je2ncybF;
	if (rank == 0) {
		auto f_alloc_nUl9sBJydU = [&] () {
			cuda_alloc_wrapper(&GPU_Data_T1je2ncybF, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_nUl9sBJydU);
	}
	if (rank == 0) {
		auto f_gpu_bzOG6cJAdH = [&] () {
			cuda_wrapper_rand_init_KeVA7GQAem_bzOG6cJAdH(GPU_Data_T1je2ncybF );
		};
		getGPUPool()->at(0).addWork(f_gpu_bzOG6cJAdH);
	}
	float* GPU_Data_UvXVPG3QEf;
	if (rank == 0) {
		auto f_alloc_nWW8BHIFNh = [&] () {
			cuda_alloc_wrapper(&GPU_Data_UvXVPG3QEf, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_nWW8BHIFNh);
	}
	if (rank == 0) {
		auto f_gpu_N0ZhsA9PUC = [&] () {
			cuda_wrapper_rand_init_VrA8skJMcp_N0ZhsA9PUC(GPU_Data_UvXVPG3QEf );
		};
		getGPUPool()->at(0).addWork(f_gpu_N0ZhsA9PUC);
	}
	float* GPU_Data_Wsg7AAZHjH;
	if (rank == 0) {
		auto f_alloc_8WhJiVqZhV = [&] () {
			cuda_alloc_wrapper(&GPU_Data_Wsg7AAZHjH, sizeof(float) * 4096);
		};
		getGPUPool()->at(0).addWork(f_alloc_8WhJiVqZhV);
	}
	if (rank == 0) {
		auto f_gpu_1Xe4UrPyk8 = [&] () {
			cuda_wrapper_rand_init_png5hzlbR4_1Xe4UrPyk8(GPU_Data_Wsg7AAZHjH );
		};
		getGPUPool()->at(0).addWork(f_gpu_1Xe4UrPyk8);
	}
	if (rank == 0) {
		Set_Partial_Array(batch_GkpriWeNHS, &f_read("batch.txt", 1LL * 262144LL * 64LL)[0], 1LL * 262144LL * 64LL);
	}
	float* GPU_Data_lRqRMUT792;
	if (rank == 0) {
		auto f_alloc_Y7gxCexjmn = [&] () {
			cuda_alloc_wrapper(&GPU_Data_lRqRMUT792, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_Y7gxCexjmn);
	}
	float* GPU_Data_9vPgbi9Ize;
	if (rank == 0) {
		auto f_alloc_KO8cTxIUIb = [&] () {
			cuda_alloc_wrapper(&GPU_Data_9vPgbi9Ize, sizeof(float) * 2621440);
		};
		getGPUPool()->at(0).addWork(f_alloc_KO8cTxIUIb);
	}
	float* GPU_Data_HyGHsZy4PV;
	if (rank == 0) {
		auto f_alloc_hyV7LBTQ8N = [&] () {
			cuda_alloc_wrapper(&GPU_Data_HyGHsZy4PV, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_hyV7LBTQ8N);
	}
	float* GPU_Data_a2Bbi3gDKr;
	if (rank == 0) {
		auto f_alloc_ae1Br6S3cA = [&] () {
			cuda_alloc_wrapper(&GPU_Data_a2Bbi3gDKr, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_ae1Br6S3cA);
	}
	float* GPU_Data_PZqL04FUfZ;
	if (rank == 0) {
		auto f_alloc_81nbDTc5up = [&] () {
			cuda_alloc_wrapper(&GPU_Data_PZqL04FUfZ, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_81nbDTc5up);
	}
	float* GPU_Data_m7mKL4pxq4;
	if (rank == 0) {
		auto f_alloc_xRVCbMXDFy = [&] () {
			cuda_alloc_wrapper(&GPU_Data_m7mKL4pxq4, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_xRVCbMXDFy);
	}
	float* GPU_Data_RzV3M8k1By;
	if (rank == 0) {
		auto f_alloc_qXAlBNtBjF = [&] () {
			cuda_alloc_wrapper(&GPU_Data_RzV3M8k1By, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_qXAlBNtBjF);
	}
	float* GPU_Data_6YfeWmVrdT;
	if (rank == 0) {
		auto f_alloc_pAD5ly1cyP = [&] () {
			cuda_alloc_wrapper(&GPU_Data_6YfeWmVrdT, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_pAD5ly1cyP);
	}
	float* GPU_Data_ATzN2Tc1vk;
	if (rank == 0) {
		auto f_alloc_XUhmunPFmX = [&] () {
			cuda_alloc_wrapper(&GPU_Data_ATzN2Tc1vk, sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_alloc_XUhmunPFmX);
	}
	if (rank == 0) {
    		Bit_Mask * mask_ptr_l01HajioCe = new Bit_Mask(2,false);
    		boost::shared_ptr<Bit_Mask>boost_mask_ptr_l01HajioCe (mask_ptr_l01HajioCe);
    		cuda_sync_device(boost_mask_ptr_l01HajioCe);
    	}
	time = get_time();
	if (rank == 0) {
		auto f_movement_3EFZCaTGgI = [&] () {
			cuda_host2device_wrapper(&GPU_Data_lRqRMUT792[0], &batch_GkpriWeNHS[0], sizeof(float) * 16777216);
		};
		getGPUPool()->at(0).addWork(f_movement_3EFZCaTGgI);
	}
	if (rank == 0) {
		auto f_gpu_tKpfCHXWeK = [&] () {
			cuda_wrapper_forward_BBhRO6II0W_tKpfCHXWeK(GPU_Data_T1je2ncybF, GPU_Data_lRqRMUT792, GPU_Data_HyGHsZy4PV );
		};
		getGPUPool()->at(0).addWork(f_gpu_tKpfCHXWeK);
	}
	if (rank == 0) {
		auto f_gpu_eed7oxtgNP = [&] () {
			cuda_wrapper_forward_F4SnxAXfxf_eed7oxtgNP(GPU_Data_HyGHsZy4PV, GPU_Data_feNa1AmxDL, GPU_Data_a2Bbi3gDKr );
		};
		getGPUPool()->at(0).addWork(f_gpu_eed7oxtgNP);
	}
	if (rank == 0) {
		auto f_gpu_oSeefsNCRE = [&] () {
			cuda_wrapper_forward_qAsnKyB9OD_oSeefsNCRE(GPU_Data_a2Bbi3gDKr, GPU_Data_Vy4uSX878x, GPU_Data_PZqL04FUfZ );
		};
		getGPUPool()->at(0).addWork(f_gpu_oSeefsNCRE);
	}
	if (rank == 0) {
		auto f_gpu_2S7PyBeDBC = [&] () {
			cuda_wrapper_forward_HmKGZlyhss_2S7PyBeDBC(GPU_Data_SDFyWcj1Ko, GPU_Data_PZqL04FUfZ, GPU_Data_m7mKL4pxq4 );
		};
		getGPUPool()->at(0).addWork(f_gpu_2S7PyBeDBC);
	}
	if (rank == 0) {
		auto f_gpu_rOG65YEVoL = [&] () {
			cuda_wrapper_forward_ojXO3RetP1_rOG65YEVoL(GPU_Data_m7mKL4pxq4, GPU_Data_Wsg7AAZHjH, GPU_Data_RzV3M8k1By );
		};
		getGPUPool()->at(0).addWork(f_gpu_rOG65YEVoL);
	}
	if (rank == 0) {
		auto f_gpu_d2Bsln4BkM = [&] () {
			cuda_wrapper_forward_QemoMWU8Ac_d2Bsln4BkM(GPU_Data_b2UXdfG3KN, GPU_Data_RzV3M8k1By, GPU_Data_6YfeWmVrdT );
		};
		getGPUPool()->at(0).addWork(f_gpu_d2Bsln4BkM);
	}
	if (rank == 0) {
		auto f_gpu_XZVJnvrdB7 = [&] () {
			cuda_wrapper_forward_l600xy7egX_XZVJnvrdB7(GPU_Data_6YfeWmVrdT, GPU_Data_UvXVPG3QEf, GPU_Data_ATzN2Tc1vk );
		};
		getGPUPool()->at(0).addWork(f_gpu_XZVJnvrdB7);
	}
	if (rank == 0) {
		auto f_gpu_sXHzo9XR1x = [&] () {
			cuda_wrapper_forward_sXHzo9XR1x(GPU_Data_ATzN2Tc1vk, GPU_Data_tEEWFEjpKO, GPU_Data_9vPgbi9Ize );
		};
		getGPUPool()->at(0).addWork(f_gpu_sXHzo9XR1x);
	}
	if (rank == 0) {
		auto f_movement_aJzooa38Kd = [&] () {
			cuda_device2host_wrapper(&result_lB8Y2jSu7K[0], &GPU_Data_9vPgbi9Ize[0], sizeof(float) * 2621440);
		};
		getGPUPool()->at(0).addWork(f_movement_aJzooa38Kd);
	}
	if (rank == 0) {
		Bit_Mask * mask_ptr_l01HajioCe = new Bit_Mask(2,false);
		boost::shared_ptr<Bit_Mask>boost_mask_ptr_l01HajioCe (mask_ptr_l01HajioCe);
		cuda_sync_device(boost_mask_ptr_l01HajioCe);
	}
	if (rank == 0) {
	    time = get_time() - time;
	    print("Time: ", time);
		array_write("result.txt", result_lB8Y2jSu7K, 1LL * 262144 * 10);
	}
	if (rank == 0) {
    		auto f_dealloc_rdHUxSpBY5 = [&] () {
    			cuda_dealloc_wrapper(GPU_Data_9vPgbi9Ize);
    		};
    		getGPUPool()->at(0).addWork(f_dealloc_rdHUxSpBY5);
    	}
	if (rank == 0) {
		auto f_dealloc_xhT5u0pMgW = [&] () {
			cuda_dealloc_wrapper(GPU_Data_b2UXdfG3KN);
		};
		getGPUPool()->at(0).addWork(f_dealloc_xhT5u0pMgW);
	}
	if (rank == 0) {
		auto f_dealloc_O2Bs2IETOD = [&] () {
			cuda_dealloc_wrapper(GPU_Data_6YfeWmVrdT);
		};
		getGPUPool()->at(0).addWork(f_dealloc_O2Bs2IETOD);
	}
	if (rank == 0) {
		auto f_dealloc_8QB7WSLjuz = [&] () {
			cuda_dealloc_wrapper(GPU_Data_ATzN2Tc1vk);
		};
		getGPUPool()->at(0).addWork(f_dealloc_8QB7WSLjuz);
	}
	if (rank == 0) {
		auto f_dealloc_sUiJrTe95M = [&] () {
			cuda_dealloc_wrapper(GPU_Data_PZqL04FUfZ);
		};
		getGPUPool()->at(0).addWork(f_dealloc_sUiJrTe95M);
	}
	if (rank == 0) {
		auto f_dealloc_aMeqaOWUbb = [&] () {
			cuda_dealloc_wrapper(GPU_Data_a2Bbi3gDKr);
		};
		getGPUPool()->at(0).addWork(f_dealloc_aMeqaOWUbb);
	}
	if (rank == 0) {
		auto f_dealloc_Ea2co5nSLr = [&] () {
			cuda_dealloc_wrapper(GPU_Data_tEEWFEjpKO);
		};
		getGPUPool()->at(0).addWork(f_dealloc_Ea2co5nSLr);
	}
	if (rank == 0) {
		auto f_dealloc_R0Xz4jM2mS = [&] () {
			cuda_dealloc_wrapper(GPU_Data_lRqRMUT792);
		};
		getGPUPool()->at(0).addWork(f_dealloc_R0Xz4jM2mS);
	}
	if (rank == 0) {
		auto f_dealloc_2QMse3c3c3 = [&] () {
			cuda_dealloc_wrapper(GPU_Data_Vy4uSX878x);
		};
		getGPUPool()->at(0).addWork(f_dealloc_2QMse3c3c3);
	}
	if (rank == 0) {
		auto f_dealloc_7NTyLExRxO = [&] () {
			cuda_dealloc_wrapper(GPU_Data_Wsg7AAZHjH);
		};
		getGPUPool()->at(0).addWork(f_dealloc_7NTyLExRxO);
	}
	if (rank == 0) {
		auto f_dealloc_8kymIH9XjI = [&] () {
			cuda_dealloc_wrapper(GPU_Data_HyGHsZy4PV);
		};
		getGPUPool()->at(0).addWork(f_dealloc_8kymIH9XjI);
	}
	if (rank == 0) {
		auto f_dealloc_WsQ4hrC5pF = [&] () {
			cuda_dealloc_wrapper(GPU_Data_T1je2ncybF);
		};
		getGPUPool()->at(0).addWork(f_dealloc_WsQ4hrC5pF);
	}
	if (rank == 0) {
		auto f_dealloc_0enyeHDIhc = [&] () {
			cuda_dealloc_wrapper(GPU_Data_m7mKL4pxq4);
		};
		getGPUPool()->at(0).addWork(f_dealloc_0enyeHDIhc);
	}
	if (rank == 0) {
		auto f_dealloc_fqRX0SAc6u = [&] () {
			cuda_dealloc_wrapper(GPU_Data_SDFyWcj1Ko);
		};
		getGPUPool()->at(0).addWork(f_dealloc_fqRX0SAc6u);
	}
	if (rank == 0) {
		auto f_dealloc_X5FaJTBRc5 = [&] () {
			cuda_dealloc_wrapper(GPU_Data_UvXVPG3QEf);
		};
		getGPUPool()->at(0).addWork(f_dealloc_X5FaJTBRc5);
	}
	if (rank == 0) {
		auto f_dealloc_UuhUUn52yQ = [&] () {
			cuda_dealloc_wrapper(GPU_Data_feNa1AmxDL);
		};
		getGPUPool()->at(0).addWork(f_dealloc_UuhUUn52yQ);
	}
	if (rank == 0) {
		auto f_dealloc_iECnyGL27n = [&] () {
			cuda_dealloc_wrapper(GPU_Data_RzV3M8k1By);
		};
		getGPUPool()->at(0).addWork(f_dealloc_iECnyGL27n);
	}
	finishExecution();
	finishGPUExecution();
	std::free(activations_1_fDjHO1CRW1);
	std::free(activations_7_RJgsycQ8Eh);
	std::free(result_lB8Y2jSu7K);
	std::free(activations_6_H4d7Vnb3tP);
	std::free(activations_3_d2FySJrNO8);
	std::free(activations_2_j3fti3BN6j);
	std::free(activations_5_gielxoWvAU);
	std::free(activations_4_UuAc29EIlG);
	std::free(batch_GkpriWeNHS);
	std::free(weights_3_aPXpgT7mlK);
	std::free(weights_2_PULl08Tzft);
	std::free(weights_1_1gUuD5JLuk);
	std::free(weights_8_exzdbedc44);
	std::free(weights_7_LJVmWXj3HV);
	std::free(weights_6_SpUa0qY8sP);
	std::free(weights_5_dUKeqRRt9x);
	std::free(weights_4_WDk6GW21eM);
	MPI_Finalize();
	return 0;


}

